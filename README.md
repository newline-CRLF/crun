# crun

`crun`は、**C/C++ソースファイルを指定するだけで自動的にコンパイル＆実行**できる、Windows用のシンプルなコマンドラインツールです。  
Pythonのような手軽さでC/C++プログラムを試したい方に最適です。

---

## 特徴

- `.c`または`.cpp`ファイルを指定するだけで自動的にコンパイル＆実行
- **インクルード内容を解析し、必要なコンパイラオプションを自動追加**
- **実行ファイルサイズを最小化する最適化オプションを自動適用**
- MinGW (gcc/g++) または Clang を利用（PATHが通っている必要あり）
- 一時ディレクトリでビルドし、実行後に自動削除（`--keep-temp`で保持可能）
- 追加のコンパイルオプションや詳細出力（`--verbose`）もサポート
- プログラム引数の指定も可能
- 標準入出力・エラーはそのまま親プロセスに引き継がれます

---

## インストール

1. **コンパイラをインストール**: [MinGW-w64](https://www.mingw-w64.org/) または [Clang](https://clang.llvm.org/) をインストールしてください。
    - インストール時、「gcc.exe」「g++.exe」または「clang.exe」「clang++.exe」がインストールされていることを確認してください。
2. **PATH環境変数を設定**: MinGWまたはClangの`bin`ディレクトリ（例: `C:\mingw-w64\bin` や `C:\Program Files\LLVM\bin`）を**PATH環境変数**に追加してください。
    - コマンドプロンプトで `gcc --version` や `clang --version` が動作すればOKです。
3. `crun.exe`を任意のディレクトリに配置し、そのディレクトリもPATHに追加すると便利です。

---

## 使い方

```sh
crun <ソースファイル> [プログラム引数...] [オプション...]
```

- `<ソースファイル>`: `.c`または`.cpp`ファイルを指定
- `[プログラム引数...]`: 実行するプログラムに渡す引数（任意）
- `[オプション...]`: crunの動作を制御するオプション（後述）

### 例

```sh
crun hello.c
crun --compiler clang hello.c
crun app.cpp arg1 arg2 --verbose
crun math.c             # math.h をインクルードしていれば -lm を自動追加
crun pthread_app.c      # pthread.h をインクルードしていれば -lpthread を自動追加
crun custom.c --cflags "-O3 -DDEBUG" # 自動オプションを上書き
crun test.cpp --keep-temp
crun benchmark.cpp --time
```

---

## オプション一覧

| オプション                | 説明                                    |
|--------------------------|-----------------------------------------|
| `--help`                 | ヘルプを表示                            |
| `--version`              | バージョン情報を表示 (v0.4.0)           |
| `--compiler <name>`      | 使用するコンパイラを指定します (`gcc` or `clang`)。デフォルトは `gcc` です。 |
| `--cflags "<flags>"`     | 追加のコンパイルフラグを指定。自動検出されたフラグを上書きします。 |
| `--keep-temp`            | 実行後も一時ディレクトリを削除しない     |
| `--verbose`, `-v`        | 詳細な出力を有効化                       |
| `--time`                 | プログラムの実行時間を計測・表示         |

- オプションは**どの位置でも指定可能**です（例: `crun --verbose hello.c` もOK）。
- `--cflags`の直後にフラグ文字列を指定してください（例: `--cflags "-Wall -O2"`）。

---

## 自動コンパイルオプション

`crun`は、コンパイル時に以下のオプションを自動的に適用します。

- **サイズ最適化**: `-Os -s` (実行ファイルサイズを最小化)
- **ライブラリ自動リンク**: ソースコードが特定のヘッダファイル（例: `pthread.h`, `math.h`）をインクルードしている場合、対応するライブラリリンクオプション（例: `-lpthread`, `-lm`）を自動的に追加します。

これらの自動オプションは、`--cflags`オプションで上書きすることが可能です。

---

## 動作の流れ

1. ソースファイルの存在と拡張子（`.c`/`.cpp`）をチェック
2. 一時ディレクトリを作成し、そこにビルド
3. **ソースファイルのインクルード内容を解析し、必要なコンパイラオプションを自動決定**
4. MinGWの`gcc.exe`/`g++.exe`またはClangの`clang.exe`/`clang++.exe`でコンパイル
5. 実行ファイルを生成し、指定した引数で実行
6. 終了後、一時ディレクトリを自動削除（`--keep-temp`指定時は保持）

---

## 注意事項

- **対応ファイル**: `.c`または`.cpp`のみ対応しています。
- **コンパイラ必須**: MinGW (gcc/g++) または Clang (clang/clang++) のインストールとPATH設定が必要です。
- **管理者権限不要**: 通常のユーザー権限で動作します。
- **一時ディレクトリ**: ソースファイルと同じディレクトリ内に`crun_tmp_...`という一時ディレクトリを作成します。
- **エラー時の挙動**: コンパイルエラーや実行エラー時はエラーメッセージを表示し、終了コード1で終了します。
- **日本語ファイル名**: 日本語やスペースを含むパスにも対応しています。

---

## よくある質問

### Q. コンパイラが見つからないと言われる

A. `gcc.exe`/`g++.exe`または`clang.exe`/`clang++.exe`がPATHに含まれているか確認してください。  
コマンドプロンプトで `gcc --version` や `clang --version` が動作すればOKです。

### Q. 一時ディレクトリが消えない

A. `--keep-temp`オプションを指定した場合や、異常終了時に残ることがあります。不要な場合は手動で削除してください。

### Q. どのコンパイラが使われますか？

A. デフォルトでは、`.c`ファイルは`gcc.exe`、`.cpp`ファイルは`g++.exe`が自動的に選択されます。`--compiler clang` オプションを指定すると、`clang.exe` と `clang++.exe` が使用されます。

### Q. 標準入力や標準出力はどうなりますか？

A. crun自身の標準入出力・エラーは、実行したプログラムにそのまま引き継がれます。

---

## ライセンス

MITライセンス

---
